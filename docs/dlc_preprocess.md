## DLC_PREPROCESS.m

**Purpose**: DeepLabCut generates a position for all frames, even when it is completely occluded. The software still finds a position that is the most likely. Sometimes, this is troublesome because it can label colored edges as the rodent's body parts. To get around this problem, we, like the DeepLabCut people, included a p-cutoff. Instead of replacing the estimated position as a `NaN`, we believe that, if the rodent is always in the point-of-view, it is very likely that the occluded part will not move that far away from when it was last seen. This is the best solution we could find to go around this technical challenge, of which will not be solved with just a single camera. 

```matlab
function [data,perc_rect] = dlc_preprocess(rawdata,llh)
```

### Prior to Usage
*Make sure you run the following to remove headers and/or convert from table into a matrix containing just the x and y positions. Also, organize the data structure corresponding to the columns and rows following the `DATA` description below.*
For example, in MATLAB, working with the .csv file generated by DeepLabCut 2.0:

```matlab
fprintf('Please select DeepLabCut generated .csv file. \n'); 
[filecsv,pathcsv] = uigetfile; 
filenamecsv = sprintf('%s%s',pathcsv,filecsv);
data_struct = importdata(filenamecsv); rawdata{i} = data_struct.data;
```

#### Inputs to DLC_PREPROCESS.m

* `RAWDATA`    6-body parts (x,y) matrix outlining the mouse viewed from bottom-up directly DeepLabCut video analyses. Rows represents frame numbers. Columns 1 & 2: Snout; Columns 3, 4, 5 & 6: two front paws (Left-Right order does not matter); Columns 7, 8, 9 & 10: two hind paws (Left-Right order does not matter); Columns 11 & 12: base of tail.
   * Last tested on 071219, using data generated by DeepLabCut 2.0, with outlier (jump) frames at 0.3%.

```python
deeplabcut.analyze_videos(config_path, video_path, save_as_csv = True)
```

- `LLH`    Likelihood threshold cut-off. User should base this on how the labeled videos from DeepLabCut looks. Default is 0.1. Video sampling frame rate. Use *VideoReader* in MATLAB or *ffmpeg* bash command to detect.  

#### Outputs of DLC_PREPROCESS.m

- `DATA`    Data matrix rectified after low-pass filter replacing the value with the most recent confident x,y.
- `PERC_RECT`    Percent rectified for each body part.  This is just to inform the user how much data is below the threshold. Consider retraining/refining the network if this value is above 15%. 

### Upon obtaining the outputs
`Option 1`
*Run [bsoid_mt.md](bsoid_mt.md) next*.

`Option 2`
*Run [bsoid_gmm.md](bsoid_gmm.md) next*.

